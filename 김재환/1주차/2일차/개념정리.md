## Thymeleaf 템플릿 엔진과 Spring Boot

### 1. 개요

Thymeleaf는 Spring Boot 애플리케이션에서 널리 사용되는 서버 사이드 템플릿 엔진이다. HTML을 동적으로 렌더링하는 데 사용되며, 자연스러운 템플릿 작성을 가능하게 한다.

### 2. 프로젝트 구조

일반적인 Spring Boot 프로젝트의 구조는 다음과 같다

```
src
├── main
│   ├── java
│   │   └── hello
│   │       └── hello_spring
│   │           ├── controller
│   │           │   └── HelloController.java
│   │           └── HelloSpringApplication.java
│   └── resources
│       ├── static
│       │   └── index.html
│       └── templates
│           └── hello.html
└── test
    └── java
        └── hello
            └── hello_spring
                └── HelloSpringApplicationTests.java
```

### 3. 컨트롤러 설정

**HelloController.java**

```
package hello.hello_spring.controller;

import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;

@Controller
public class HelloController {

    @GetMapping("/hello")
    public String hello(Model model) {
        model.addAttribute("data", "hello!!");
        return "hello";
    }
}
```

**주요 포인트:**
- @Controller 어노테이션을 사용하여 이 클래스가 컨트롤러임을 명시한다.
- @GetMapping("/hello") 어노테이션으로 /hello 경로에 대한 GET 요청을 처리한다.
- Model 객체를 통해 뷰에 데이터를 전달한다.
- 메서드의 반환값 "hello"는 템플릿 이름을 나타낸다.

### 4. 템플릿 작성

**hello.html**

```
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
</head>
<body>
    <p th:text="'안녕하세요. ' + ${data}">안녕하세요 손님</p>
</body>
</html>
```

**주요 포인트:**
- xmlns:th="http://www.thymeleaf.org": Thymeleaf 네임스페이스를 선언한다.
- th:text: Thymeleaf의 텍스트 치환 속성이다.
- ${data}: 컨트롤러에서 전달된 모델 속성에 접근한다.

### 5. 정적 페이지

**index.html**

```
<!DOCTYPE HTML>
<html>
<head>
    <title>Hello</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
</head>
<body>
    Hello
    <a href="/hello">hello</a>
</body>
</html>
```

이 파일은 static 폴더에 위치하며, 애플리케이션의 루트 경로(/)에 접근할 때 표시된다.

### 6. 동작 원리

1. 웹 브라우저에서 http://localhost:8080/hello 로 요청을 보낸다.

2. 스프링 부트의 내장 톰캣 서버가 요청을 받는다.

3. 스프링 컨테이너 내의 helloController가 요청을 처리한다.
   - @GetMapping("/hello") 어노테이션에 의해 매핑된다.
   - hello 메서드가 실행되어 model에 "data":"hello!!" 를 추가한다.
   - "hello"를 반환하여 뷰 이름을 지정한다.

4. viewResolver가 화면을 찾아서 처리한다.
   - 스프링 부트 템플릿엔진 기본 viewName 매핑: resources:templates/ +{ViewName}+ .html
   - 여기서는 resources:templates/hello.html 파일을 찾는다.

5. Thymeleaf 템플릿 엔진이 hello.html을 처리한다.
   - ${data}를 model에서 가져온 "hello!!"로 치환한다.

6. 변환된 HTML 파일을 웹 브라우저에 반환한다.

7. 최종적으로 "안녕하세요. hello!!"가 사용자에게 표시된다.

참고: spring-boot-devtools 라이브러리를 추가하면, html 파일을 컴파일만 해주면 서버 재시작 없이 View 파일 변경이 가능하다. 
IntelliJ 컴파일 방법: 메뉴 build -> Recompile

![image](https://github.com/user-attachments/assets/fa5a5e4f-612d-4be3-83dd-a60b3fad3f7f)

### 빌드와 실행

빌드는 간단하다

```
./gradlew.bat build
```

디렉토리를 맞춘 후 위 명령어를 입력하면 build/libs라는 폴더에 jar파일이 생긴다.

```
PS E:\Github_Study\spring-study\hello-spring> cd build
PS E:\Github_Study\spring-study\hello-spring\build> cd libs
PS E:\Github_Study\spring-study\hello-spring\build\libs> java -jar hello-spring-0.0.1-SNAPSHOT.jar
```

그리고 위와같이 실행시키면 intelliJ로 실행시킨 것과 동일하게 실행 시킬 수 있다.

### 정적 컨텐츠

![image](https://github.com/user-attachments/assets/367f5ee7-3c27-4cf9-bcc1-c388ea312d13)

정적 컨텐츠는 static 폴더에 html파일을 만들어 작성하면 localhost로 브라우저에 접속하고 엔트포인트로 /hello-static.html 요청시 스프링 부트의 내장 톰캣 서버로 전달되고 hello-static 관련 컨트롤러를 찾는다. 만약 컨트롤러가 없다면 resources: static/hello-static.html 파일을 찾는다.

파일을 찾으면 위와 같이 파일을 출력하는 것이다.

하지만 이 페이지는 데이터를 주고받거나 별도의 프로그래밍은 불가능하다.

### MVC와 템플릿 엔진

- **MVC**

옛날에는 View와 Controller가 분리되어 있지 않았다.

현재는 MVC 스타일로 많이 하는데 관심사를 분리하고 View는 화면을 그리는데 집중하고 Controller는 Business 로직과 관련이 있거나 내부적인 것을 처리하는데 집중한다.

그래서 Model, View, Controller로 분리되었다. 이 약자가 바로 MVC이다.

- **템플릿 엔진**

템플릿 엔진은 아까 봤던 정적 컨텐츠와는 달리 데이터를 파라미터로 주고받을 수 있고 이런 데이터들을 템플릿 엔진에서 변환시켜 웹 브라우저로 넘겨줄 수 있다.
